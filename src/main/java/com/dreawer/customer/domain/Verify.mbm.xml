<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dreawer.account.domain.Verify">
	
	<!-- ================================================================================== -->
	<!-- SQL语句（增加）																		-->
	<!-- ================================================================================== -->
	
	<!-- 保存地址信息 -->
	<insert id="save" parameterType="Verify">
        INSERT INTO aci_verify(id, usr_id, type, phn_num, email, value)
        VALUES(#{id}, #{user.id}, #{type}, #{phoneNumber}, #{email}, #{value})
    </insert>
    
    <!-- ================================================================================== -->
	<!-- SQL语句（删除）																		-->
	<!-- ================================================================================== -->
	
    <!-- 删除地址信息 -->
    <delete id="delete" parameterType="Verify">
    	DELETE FROM aci_verify
    	WHERE id = #{id}
    </delete>
    
    <!-- ================================================================================== -->
	<!-- SQL语句（更新）																		-->
	<!-- ================================================================================== -->
	
	<!-- 更新认证信息 -->
	<update id="update" parameterType="Verify">
		UPDATE aci_verify
		SET usr_id=#{user.id}, type=#{type}, phn_num=#{phoneNumber}, 
			email=#{email}, value=#{value}, cre_tim=#{createTime}
		WHERE id = #{id} 
	</update>
	
    <!-- ================================================================================== -->
	<!-- SQL语句（查询）																		-->
	<!-- ================================================================================== -->
	
	<!-- 查询地址信息 -->
    <select id="findVerify" parameterType="Verify" resultMap="verifyResultMap">
        SELECT id, usr_id, type, phn_num, email, cre_tim
        FROM aci_verify
        <choose>  
            <when test="type=='EMAIL'">  
                WHERE email=#{email}
            </when>  
            <when test="type=='PHONE'">  
                WHERE phn_num=#{phoneNumber}
            </when>  
            <otherwise>  
                WHERE 1=1 
            </otherwise>  
        </choose>  
    </select>
    
	<!-- 查询认证信息 -->
    <select id="findVerifyByPhone" parameterType="Map" resultMap="verifyResultMap">
        SELECT id, usr_id, type, phn_num, email, cre_tim
        FROM aci_verify
        WHERE phn_num=#{phone} AND value=#{value}
    </select>
    
    <!-- 查询认证信息 -->
    <select id="findVerifyByEmail" parameterType="Map" resultMap="verifyResultMap">
        SELECT id, usr_id, type, phn_num, email, cre_tim
        FROM aci_verify
        WHERE email=#{email} AND value=#{value}
    </select>
    
    <!-- ================================================================================== -->
	<!-- 公用SQL定义																			-->
	<!-- ================================================================================== -->
    
    <!-- 地址基本信息字段 -->
	<sql id="verifyBasicFields">
		id, usr_id, type, phn_num, email, value, cre_tim
	</sql>
	
    <!-- ================================================================================== -->
	<!-- 结果集映射																			    -->
	<!-- ================================================================================== -->
	
	<!-- 地址基本信息 -->
    <resultMap id="verifyResultMap" type="Verify">
		<id property="id" column="id" />
		<result property="user.id" column="usr_id" />
		<result property="type" column="type" />
		<result property="phoneNumber" column="phn_num" />
		<result property="email" column="email" />
		<result property="value" column="value" />
		<result property="createTime" column="cre_tim" />
	</resultMap>
</mapper>